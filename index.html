<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClimaJá! - Monitoramento Meteorológico</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.12/css/weather-icons.min.css">

    <style>
        :root {
            --primary: #2563EB;
            --secondary: #1D4ED8;
            --background: #f8fafc;
            --text: #1e293b;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --primary: #60a5fa;
            --secondary: #3b82f6;
            --background: #0f172a;
            --text: #f8fafc;
            --card-bg: #1e293b;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--background);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .navbar {
            box-shadow: var(--shadow);
        }

        .main-card {
            background: var(--card-bg);
            border-radius: 1rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        #map {
            height: 60vh;
            border-radius: 0.75rem;
            border: 1px solid var(--border);
            background: var(--card-bg);
        }

        .weather-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .weather-icon {
            font-size: 3rem;
            color: var(--primary);
        }

        .sensor-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .weather-item {
            padding: 1rem;
            border-radius: 0.5rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            text-align: center;
            color: var(--text);
        }

        .theme-switcher {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            cursor: pointer;
            display: grid;
            place-items: center;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .report-marker {
            background: #dc2626;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .form-control {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text);
        }

        .nav-pills .nav-link {
            background: var(--card-bg);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .nav-pills .nav-link.active {
            background: var(--primary) !important;
            border-color: var(--primary);
            color: white !important;
        }

        .dropdown-menu {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            margin-top: 2px;
            display: none;
        }
        
        .dropdown-item {
            color: var(--text);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dropdown-item:hover {
            background: var(--primary);
            color: white;
        }
        
        .dropdown-item small {
            color: inherit;
            opacity: 0.7;
        }
        
        .show {
            display: block;
        }

        .vehicle-suggestions {
            position: absolute;
            z-index: 1000;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            box-shadow: var(--shadow);
            display: none;
        }
        
        .vehicle-item {
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
        }
        
        .vehicle-item:hover {
            background: var(--primary);
            color: white;
        }

        .wi {
            color: var(--text);
        }
    </style>
</head>
<body>
    <div class="theme-switcher" onclick="toggleTheme()">
        <i class="fas fa-moon"></i>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="logo.png" alt="ClimaJá!" class="me-2" style="height: 40px;">
                ClimaJá!
            </a>
        </div>
    </nav>

    <div class="container my-4">
        <ul class="nav nav-pills justify-content-center mb-4">
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="pill" href="#mapa">
                    <i class="fas fa-map me-2"></i>Mapa
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#clima">
                    <i class="fas fa-sun me-2"></i>Clima
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="pill" href="#relatar">
                    <i class="fas fa-edit me-2"></i>Relatar
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="mapa">
                <div class="main-card">
                    <div id="map"></div>
                    <div class="mt-3 text-center">
                        <button class="btn btn-primary" onclick="locateUser(true)">
                            <i class="fas fa-location-crosshairs me-2"></i>Minha Localização
                        </button>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="clima">
                <div class="main-card">
                    <div class="weather-header">
                        <i class="wi wi-day-sunny weather-icon"></i>
                        <div>
                            <h2 class="mb-0" id="city-name">Carregando...</h2>
                            <div class="sensor-value" id="current-temp">--°C</div>
                        </div>
                    </div>
                    
                    <div class="weather-grid">
                        <div class="weather-item">
                            <i class="wi wi-humidity"></i>
                            <div class="mt-2">
                                <div class="text-muted small">Umidade</div>
                                <div class="fw-bold" id="humidity">--%</div>
                            </div>
                        </div>
                        <div class="weather-item">
                            <i class="wi wi-rain"></i>
                            <div class="mt-2">
                                <div class="text-muted small">Chuva</div>
                                <div class="fw-bold" id="rain">--mm</div>
                            </div>
                        </div>
                        <div class="weather-item">
                            <i class="wi wi-strong-wind"></i>
                            <div class="mt-2">
                                <div class="text-muted small">Vento</div>
                                <div class="fw-bold" id="wind-speed">--km/h</div>
                            </div>
                        </div>
                        <div class="weather-item">
                            <i class="wi wi-barometer"></i>
                            <div class="mt-2">
                                <div class="text-muted small">Pressão</div>
                                <div class="fw-bold" id="pressure">--hPa</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="relatar">
                <div class="main-card">
                    <h4 class="mb-4"><i class="fas fa-plus-circle me-2"></i>Novo Relato</h4>
                    <form id="reportForm">
                        <div class="mb-3">
                            <label class="form-label">Tipo de Relato</label>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-primary active" onclick="toggleReportType('pedestre')">
                                    <i class="fas fa-person-walking me-2"></i>Pedestre
                                </button>
                                <button type="button" class="btn btn-outline-primary" onclick="toggleReportType('motorista')">
                                    <i class="fas fa-car-side me-2"></i>Motorista
                                </button>
                            </div>
                        </div>

                        <div id="pedestre-form">
                            <div class="mb-3">
                                <label class="form-label">Nível da Água</label>
                                <select class="form-select" id="water-level" required>
                                    <option value="">Selecione o nível</option>
                                    <option value="0.2">Tornozelo (0-0.2m)</option>
                                    <option value="0.5">Panturrilha (0.2-0.5m)</option>
                                    <option value="1.0">Joelho (0.5-1.0m)</option>
                                    <option value="1.5">Cintura (1.0-1.5m)</option>
                                    <option value="2.0">Peito (+1.5m)</option>
                                </select>
                            </div>
                        </div>

                        <div id="motorista-form" class="d-none">
                            <div class="mb-3">
                                <label class="form-label">Modelo do Veículo</label>
                                <div class="position-relative">
                                    <input type="text" class="form-control" id="vehicle-model" 
                                           placeholder="Ex: Fiat Uno 1.0" required
                                           autocomplete="off">
                                    <div id="vehicle-suggestions" class="vehicle-suggestions"></div>
                                </div>
                                <small class="text-muted">Comece a digitar o modelo do veículo</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Ano do Veículo</label>
                                <select class="form-select" id="vehicle-year" required>
                                    <option value="">Selecione o ano</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nível de Submersão</label>
                                <select class="form-select" id="car-water-level" required>
                                    <option value="">Selecione o nível</option>
                                    <option value="25">Rodas (25%)</option>
                                    <option value="50">Portas (50%)</option>
                                    <option value="75">Capô (75%)</option>
                                    <option value="100">Totalmente Submerso</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><i class="fas fa-map-marker-alt me-2"></i>Localização</label>
                            <div class="position-relative">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="address" 
                                           placeholder="Digite um endereço" 
                                           autocomplete="off"
                                           required>
                                    <button class="btn btn-outline-secondary" type="button" onclick="searchLocation()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div id="address-suggestions" class="dropdown-menu w-100"></div>
                            </div>
                            <small class="text-muted">Comece a digitar para buscar locais</small>
                        </div>

                        <div class="mb-4">
                            <label class="form-label"><i class="fas fa-camera me-2"></i>Foto do Local (Opcional)</label>
                            <input type="file" class="form-control" id="flood-photo" accept="image/*">
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-paper-plane me-2"></i>Enviar Relato
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let map, markers, userMarker, reportMarker = null;
        let currentTheme = localStorage.getItem('theme') || 'light';
        const API_KEY = '71907d1b560a5fae3ee6d175e1d9129b';
        let geocodeTimeout, vehicleTimeout;
        let currentReportType = 'pedestre';
        let selectedVehicle = null;
        const FIPE_API = 'https://parallelum.com.br/fipe/api/v1/carros/marcas';

        function initMap() {
            map = L.map('map', {
                center: [-15.788, -47.879],
                zoom: 4,
                renderer: L.canvas()
            });

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            markers = L.markerClusterGroup();
            map.addLayer(markers);
            applyTheme(currentTheme);
            loadSavedReports();
            locateUser(true);
        }

        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', currentTheme);
            applyTheme(currentTheme);
        }

        function applyTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            document.querySelector('.theme-switcher i').className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            if(map) {
                const tiles = document.querySelector('.leaflet-layer');
                tiles.style.filter = theme === 'dark' ? 'invert(1) hue-rotate(180deg) brightness(0.9)' : 'none';
            }
        }

        function locateUser(initial = false) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    updateUserPosition(latitude, longitude);
                    getWeatherData(latitude, longitude);
                }, (error) => {
                    if(initial) showNotification('Ative a localização para melhor precisão', 'warning');
                }, { enableHighAccuracy: true });
            }
        }

        function updateUserPosition(lat, lng) {
            if(userMarker) map.removeLayer(userMarker);
            userMarker = L.marker([lat, lng], {
                icon: L.icon({
                    iconUrl: 'user-marker.png',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    popupAnchor: [0, -40]
                })
            }).addTo(map);
            map.flyTo([lat, lng], 15);
        }

        async function getWeatherData(lat, lon) {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=pt_br`);
                const data = await response.json();
                
                document.getElementById('current-temp').textContent = `${Math.round(data.main.temp)}°C`;
                document.getElementById('humidity').textContent = `${data.main.humidity}%`;
                document.getElementById('wind-speed').textContent = `${(data.wind.speed * 3.6).toFixed(1)}km/h`;
                document.getElementById('pressure').textContent = `${data.main.pressure}hPa`;
                document.getElementById('rain').textContent = data.rain ? `${(data.rain['1h'] || 0).toFixed(1)}mm` : '0.0mm';
                
                const weatherIcon = document.querySelector('.weather-icon');
                weatherIcon.className = `wi wi-owm-${data.weather[0].id} weather-icon`;
                getCityName(lat, lon);
                
            } catch (error) {
                showNotification('Erro ao carregar dados do clima', 'danger');
            }
        }

        async function getCityName(lat, lon) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                const data = await response.json();
                const city = data.address.city || data.address.town || data.address.village || data.address.county;
                document.getElementById('city-name').textContent = city;
            } catch (error) {
                console.error('Erro ao obter nome da cidade:', error);
            }
        }

        document.getElementById('address').addEventListener('input', () => {
            clearTimeout(geocodeTimeout);
            const input = document.getElementById('address').value;
            
            if(input.length < 3) {
                document.getElementById('address-suggestions').classList.remove('show');
                return;
            }
            
            geocodeTimeout = setTimeout(() => searchLocation(), 500);
        });

        async function searchLocation(suggestion = null) {
            const addressInput = document.getElementById('address');
            const suggestionsDiv = document.getElementById('address-suggestions');
            
            if(suggestion) {
                const { lat, lon, display_name } = suggestion;
                addressInput.value = display_name;
                if(reportMarker) map.removeLayer(reportMarker);
                updateReportMarker(lat, lon);
                map.flyTo([lat, lon], 15);
                suggestionsDiv.classList.remove('show');
                return;
            }

            const address = addressInput.value.trim();
            if(!address) return;

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&addressdetails=1&limit=5`);
                const data = await response.json();
                
                suggestionsDiv.innerHTML = '';
                if(data.length > 0) {
                    data.forEach(result => {
                        const item = document.createElement('div');
                        item.className = 'dropdown-item';
                        item.innerHTML = `<div>${result.display_name.split(',')[0]}</div><small>${result.display_name}</small>`;
                        item.onclick = () => searchLocation({
                            lat: parseFloat(result.lat),
                            lon: parseFloat(result.lon),
                            display_name: result.display_name
                        });
                        suggestionsDiv.appendChild(item);
                    });
                    suggestionsDiv.classList.add('show');
                } else {
                    suggestionsDiv.classList.remove('show');
                }
            } catch (error) {
                showNotification('Erro ao buscar localização', 'danger');
            }
        }

        function updateReportMarker(lat, lng) {
            if(reportMarker) map.removeLayer(reportMarker);
            
            reportMarker = L.marker([lat, lng], {
                draggable: true,
                icon: L.divIcon({
                    className: 'report-marker',
                    html: '<i class="fas fa-map-pin"></i>',
                    iconSize: [40, 40]
                })
            }).addTo(map);
            
            reportMarker.on('dragend', async () => {
                const { lat, lng } = reportMarker.getLatLng();
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                    const data = await response.json();
                    document.getElementById('address').value = data.display_name || `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                } catch (error) {
                    document.getElementById('address').value = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                }
            });
        }

        document.getElementById('reportForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if(!reportMarker) {
                showNotification('Selecione uma localização no mapa', 'warning');
                return;
            }

            let valid = true;
            if(currentReportType === 'pedestre') {
                if(!document.getElementById('water-level').value) {
                    showNotification('Selecione o nível da água', 'warning');
                    valid = false;
                }
            } else {
                if(!selectedVehicle || !document.getElementById('vehicle-year').value) {
                    showNotification('Selecione um veículo válido', 'warning');
                    valid = false;
                }
                if(!document.getElementById('car-water-level').value) {
                    showNotification('Selecione o nível de submersão', 'warning');
                    valid = false;
                }
            }

            if(!valid) return;

            const report = {
                type: currentReportType,
                location: reportMarker.getLatLng(),
                details: currentReportType === 'pedestre' ? {
                    waterLevel: document.getElementById('water-level').value,
                    levelText: document.getElementById('water-level').options[document.getElementById('water-level').selectedIndex].text
                } : {
                    vehicle: {
                        fipeCode: selectedVehicle.codigo,
                        brand: selectedVehicle.marca,
                        model: selectedVehicle.nome,
                        year: document.getElementById('vehicle-year').options[document.getElementById('vehicle-year').selectedIndex].text
                    },
                    submersionLevel: document.getElementById('car-water-level').value,
                    levelText: document.getElementById('car-water-level').options[document.getElementById('car-water-level').selectedIndex].text
                },
                photo: await readPhoto(),
                timestamp: new Date()
            };

            addReportToMap(report);
            saveReport(report);
            showNotification('Relato enviado com sucesso!', 'success');
            document.getElementById('reportForm').reset();
            selectedVehicle = null;
            document.getElementById('vehicle-year').innerHTML = '<option value="">Selecione o ano</option>';
        });

        async function readPhoto() {
            const file = document.getElementById('flood-photo').files[0];
            return file ? new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.readAsDataURL(file);
            }) : null;
        }

        function addReportToMap(report) {
            const marker = L.marker([report.location.lat, report.location.lng], {
                icon: L.divIcon({
                    html: `<div style="background:${getColorByLevel(report)}" class="report-marker">
                            ${report.type === 'pedestre' ? '🚶' : '🚗'}
                          </div>`
                })
            }).bindPopup(createPopupContent(report));
            markers.addLayer(marker);
        }

        function getColorByLevel(report) {
            const levels = {
                pedestre: { '0.2': '#10B981', '0.5': '#F59E0B', '1.0': '#EF4444', '1.5': '#DC2626', '2.0': '#7C3AED' },
                motorista: { '25': '#10B981', '50': '#F59E0B', '75': '#EF4444', '100': '#DC2626' }
            };
            return levels[report.type][report.details[report.type === 'pedestre' ? 'waterLevel' : 'submersionLevel']];
        }

        function createPopupContent(report) {
            return `
                <div style="min-width: 250px">
                    <h6>${report.type === 'pedestre' ? 'Relato de Pedestre' : 'Relato de Motorista'}</h6>
                    <div class="mb-2">
                        <strong>Nível:</strong> ${report.details.levelText}
                    </div>
                    ${report.type === 'motorista' ? `
                    <div class="mb-2">
                        <strong>Veículo:</strong> ${report.details.vehicle.brand} ${report.details.vehicle.model}<br>
                        <strong>Ano:</strong> ${report.details.vehicle.year}
                    </div>` : ''}
                    ${report.photo ? `<img src="${report.photo}" class="img-fluid mt-2 mb-2">` : ''}
                    <small class="text-muted">${new Date(report.timestamp).toLocaleString()}</small>
                </div>
            `;
        }

        function saveReport(report) {
            const reports = JSON.parse(localStorage.getItem('floodReports') || '[]');
            reports.push(report);
            localStorage.setItem('floodReports', JSON.stringify(reports));
        }

        function loadSavedReports() {
            const reports = JSON.parse(localStorage.getItem('floodReports') || '[]');
            reports.forEach(addReportToMap);
        }

        function toggleReportType(type) {
            currentReportType = type;
            document.querySelectorAll('.btn-outline-primary').forEach(btn => {
                btn.classList.remove('active');
                btn.style.color = 'var(--text)';
            });
            event.target.classList.add('active');
            document.querySelectorAll('[id$="-form"]').forEach(el => el.classList.add('d-none'));
            document.getElementById(`${type}-form`).classList.remove('d-none');
        }

        document.getElementById('vehicle-model').addEventListener('input', async (e) => {
            clearTimeout(vehicleTimeout);
            const query = e.target.value.trim();
            const suggestions = document.getElementById('vehicle-suggestions');
            
            if(query.length < 3) {
                suggestions.style.display = 'none';
                return;
            }
            
            vehicleTimeout = setTimeout(async () => {
                const results = await searchVehicles(query);
                suggestions.innerHTML = '';
                
                if(results.length > 0) {
                    results.forEach(vehicle => {
                        const div = document.createElement('div');
                        div.className = 'vehicle-item';
                        div.textContent = `${vehicle.marca} ${vehicle.nome}`;
                        div.onclick = () => selectVehicle(vehicle);
                        suggestions.appendChild(div);
                    });
                    suggestions.style.display = 'block';
                } else {
                    suggestions.style.display = 'none';
                }
            }, 500);
        });

        async function searchVehicles(query) {
            try {
                const brands = await (await fetch(FIPE_API)).json();
                const models = [];
                
                for (const brand of brands.slice(0, 3)) {
                    const brandModels = await (await fetch(`${FIPE_API}/${brand.codigo}/modelos`)).json();
                    const filtered = brandModels.modelos.filter(model => 
                        model.nome.toLowerCase().includes(query.toLowerCase())
                    );
                    models.push(...filtered.map(m => ({
                        ...m,
                        marca: brand.nome,
                        marcaCodigo: brand.codigo
                    })));
                }
                
                return models.slice(0, 5);
            } catch (error) {
                showNotification('Erro ao buscar modelos de veículos', 'danger');
                return [];
            }
        }

        async function selectVehicle(vehicle) {
            selectedVehicle = vehicle;
            document.getElementById('vehicle-model').value = `${vehicle.marca} ${vehicle.nome}`;
            document.getElementById('vehicle-suggestions').style.display = 'none';
            
            const years = await getVehicleYears(vehicle.marcaCodigo, vehicle.codigo);
            const yearSelect = document.getElementById('vehicle-year');
            yearSelect.innerHTML = '<option value="">Selecione o ano</option>';
            
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year.codigo;
                option.textContent = year.nome;
                yearSelect.appendChild(option);
            });
        }

        async function getVehicleYears(brandCode, modelCode) {
            try {
                const response = await fetch(`${FIPE_API}/${brandCode}/modelos/${modelCode}/anos`);
                return await response.json();
            } catch (error) {
                showNotification('Erro ao buscar anos do veículo', 'danger');
                return [];
            }
        }

        function showNotification(message, type) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} position-fixed top-0 end-0 m-3`;
            alert.textContent = message;
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), 3000);
        }

        document.addEventListener('click', (e) => {
            if(!e.target.closest('#address') && !e.target.closest('#address-suggestions')) {
                document.getElementById('address-suggestions').classList.remove('show');
            }
            if(!e.target.closest('#vehicle-model') && !e.target.closest('#vehicle-suggestions')) {
                document.getElementById('vehicle-suggestions').style.display = 'none';
            }
        });

        initMap();
    </script>
</body>
</html>
